---
# Playbook for Vault initialization only
- name: Initialize HashiCorp Vault
  hosts: vault_servers
  gather_facts: yes
  become: no
  vars:
    ansible_python_interpreter: "{{ ansible_playbook_python }}"

  roles:
    - role: vault-init

  post_tasks:
    - name: Display initialization summary
      debug:
        msg: |
          Vault Initialization Complete!

          Vault Address: {{ vault_addr }}
          Root Token: {{ vault_root_token | default('(run again or check ' ~ vault_root_token_file ~ ')') }}
          Unseal Keys File: {{ vault_unseal_keys_file }}
          Root Token File: {{ vault_root_token_file }}

          Note: {{ vault_root_token_file }} is only written when this playbook performs initialization (first run or -e vault_force_init=true). On other runs it is not overwritten. If the token fails (e.g. after recreating Vault), run with -e vault_force_init=true to re-init and update the file.

          UI login: Open http://localhost:8200/ui (use localhost). Method: Token. Copy token with: cat {{ vault_root_token_file }} | tr -d '\\n'

          IMPORTANT: Secure these files immediately!
